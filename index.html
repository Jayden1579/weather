<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ì˜ ë‚ ì”¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-blue-100 to-white min-h-screen flex flex-col items-center justify-start px-4 py-10 space-y-8">

  <!-- ì˜¤ëŠ˜ ë‚ ì”¨ ì¹´ë“œ -->
  <div class="bg-white p-6 rounded-2xl shadow-xl max-w-sm w-full text-center">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">ì˜¤ëŠ˜ì˜ ë‚ ì”¨</h2>
    <div id="today" class="text-gray-700 text-base">ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘â€¦</div>
  </div>

  <!-- ë‚´ì¼ ë‚ ì”¨ ì¹´ë“œ -->
  <div class="bg-white p-6 rounded-2xl shadow-xl max-w-sm w-full text-center">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">ë‚´ì¼ì˜ ë‚ ì”¨</h2>
    <div id="tomorrow" class="text-gray-700 text-base">ë‚ ì”¨ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
  </div>

  <script>
    const API_KEY = '8f2523019426e1bebc6ea6593faea845';

    function formatTemp(t) {
      return t.toFixed(1);
    }

    async function fetchWeather(lat, lon) {
      try {
        // í˜„ì¬ ë‚ ì”¨
        const nowRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=kr&appid=${API_KEY}`);
        const nowData = await nowRes.json();
        const location = nowData.name;

        // ë¯¸ì„¸ë¨¼ì§€
        const dustRes = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`);
        const dust = await dustRes.json();
        const pm10 = Math.round(dust.list[0].components.pm10);
        let dustLevel = 'ì¢‹ìŒ';
        if (pm10 > 80) dustLevel = 'ë‚˜ì¨';
        else if (pm10 > 30) dustLevel = 'ë³´í†µ';

        // ì˜ˆë³´ ë°ì´í„°
        const forecastRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&lang=kr&appid=${API_KEY}`);
        const forecast = await forecastRes.json();

        const today = new Date().toISOString().split('T')[0];
        const tomorrow = new Date(Date.now() + 86400000).toISOString().split('T')[0];

        let todayTemps = [];
        let tomorrowTemps = [];
        let tomorrowDescriptions = [];

        forecast.list.forEach(entry => {
          const date = entry.dt_txt.split(' ')[0];
          const temp = entry.main.temp;
          if (date === today) todayTemps.push(temp);
          if (date === tomorrow) {
            tomorrowTemps.push(temp);
            tomorrowDescriptions.push(entry.weather[0].description);
          }
        });

        const todayMin = Math.min(...todayTemps);
        const todayMax = Math.max(...todayTemps);

        const tomorrowMin = Math.min(...tomorrowTemps);
        const tomorrowMax = Math.max(...tomorrowTemps);
        const mostCommonDesc = getMostFrequent(tomorrowDescriptions);

        // ì˜¤ëŠ˜ í‘œì‹œ
        document.getElementById('today').innerHTML = `
          <p class="text-lg font-semibold">${location}</p>
          <p class="mt-2 text-3xl font-bold text-blue-600">${formatTemp(nowData.main.temp)}Â°C</p>
          <p class="text-sm text-gray-500">ìµœì € ${formatTemp(todayMin)}Â° / ìµœê³  ${formatTemp(todayMax)}Â°</p>
          <p class="mt-2 text-base">ğŸŒ¤ï¸ ${nowData.weather[0].description}</p>
          <p class="mt-1 text-sm text-gray-600">ë¯¸ì„¸ë¨¼ì§€(PM10): ${pm10}ã/ã¥ <span class="font-semibold">(${dustLevel})</span></p>
        `;

        // ë‚´ì¼ í‘œì‹œ
        document.getElementById('tomorrow').innerHTML = `
          <p class="text-lg font-semibold">ì˜ˆìƒ ê¸°ì˜¨</p>
          <p class="mt-2 text-2xl font-bold text-orange-500">${formatTemp(tomorrowMin)}Â° / ${formatTemp(tomorrowMax)}Â°</p>
          <p class="mt-2 text-base">â˜ï¸ ${mostCommonDesc}</p>
        `;

      } catch (e) {
        console.error(e);
        document.getElementById('today').innerHTML = `<p class="text-red-600">ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
      }
    }

    function getMostFrequent(arr) {
      const count = {};
      let max = 0, result = '';
      arr.forEach(val => {
        count[val] = (count[val] || 0) + 1;
        if (count[val] > max) {
          max = count[val];
          result = val;
        }
      });
      return result;
    }

    function getLocationAndFetch() {
      if (!navigator.geolocation) {
        document.getElementById('today').innerText = 'ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ ì§€ì›ì´ ì•ˆ ë©ë‹ˆë‹¤.';
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => fetchWeather(pos.coords.latitude, pos.coords.longitude),
        err => {
          console.error(err);
          document.getElementById('today').innerText = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
        }
      );
    }

    getLocationAndFetch();
  </script>
</body>
</html>
